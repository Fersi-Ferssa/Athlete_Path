<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil del Atleta</title>
</head>
<body>
    {% if messages %}
    <div>
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
    </div>
    {% endif %}
    
    <div class="profile-container">
        <h1>Bienvenido, <span class="highlight">{{ profile.user.first_name }} {{ profile.user.last_name }}</span> (Atleta)</h1>
        
        <div class="info-block">
            <h2>Información del Atleta</h2>
            <p><strong>Disciplina:</strong> <span class="highlight">{{ profile.discipline }}</span></p>
            <p><strong>Rama:</strong> <span class="highlight">{{ profile.branch }}</span></p>
            <p><strong>Nacionalidad:</strong> <span class="highlight">{{ profile.olympic_country }}</span></p>
            <p><strong>Nombre del Equipo:</strong> <span class="highlight">{{ team_name }}</span></p>
        </div>

        <!-- Última evaluación del atleta -->
        <div class="info-block">
            <h3>Última Evaluación</h3>
            {% if latest_record %}
                <p><strong>Dificultad:</strong> <span class="highlight">{{ latest_record.difficulty }}</span></p>
                <p><strong>Ejecución:</strong> <span class="highlight">{{ latest_record.execution }}</span></p>
                <p><strong>Puntuación:</strong> <span class="highlight">{{ latest_record.total_score }}</span></p>
                <p><strong>Fecha de Evaluación:</strong> <span class="highlight">{{ latest_record.evaluation_date }}</span></p>
                <p><strong>Notas:</strong> <span class="highlight">{{ latest_record.notes }}</span></p>
            {% else %}
                <p>No tienes evaluaciones disponibles aún.</p>
            {% endif %}
        </div>

        <!-- Mostrar el campeón de las Olimpiadas 2024 -->
        {% if champion %}
        <div class="info-block">
            <h3>Ganadora Olimpiadas París 2024: <span class="highlight">{{ champion.name }}</span></h3>
            <p><strong>País:</strong> <span class="highlight">{{ champion.country }}</span></p>
            <p><strong>Dificultad:</strong> <span class="highlight">{{ champion.difficulty }}</span></p>
            <p><strong>Ejecución:</strong> <span class="highlight">{{ champion.execution }}</span></p>
            <p><strong>Puntuación:</strong> <span class="highlight">{{ champion.score }}</span></p>
        </div>
        {% endif %}

        <!-- Lista de mejores atletas para compararse -->
        <div class="info-block">
            <h3>Mejores Atletas</h3>
            <ul>
                {% if best_athletes %}
                    {% for athlete in best_athletes %}
                    <li>
                        <a href="{% url 'athlete_profile' athlete.id %}">
                            <strong class="highlight">{{ athlete.user.first_name }} {{ athlete.user.last_name }}</strong>
                        </a>
                        - {{ athlete.olympic_country }} - Puntuación: <span class="highlight">{{ athlete.max_score }}</span>
                    </li>
                    {% endfor %}
                {% else %}
                    <li>No hay más atletas para mostrar.</li>
                {% endif %}
            </ul>
        </div>

        <!-- Historial de evaluaciones del atleta -->
        <div class="info-block">
            <h3>Historial de Evaluaciones</h3>
            <ul>
                {% for record in athlete_records %}
                <li>
                    <strong>{{ record.evaluation_date }}:</strong> Dificultad: {{ record.difficulty }}, Ejecución: {{ record.execution }}, Puntuación: {{ record.total_score }}, Notas: {{ record.notes }}
                    
                    <!-- Solo mostrar opciones si el coach actual es quien creó el registro -->
                    {% if can_edit_records %}
                        <a href="{% url 'edit_record' record.id %}">Editar</a> |
                        <a href="{% url 'delete_record' record.id %}" onclick="return confirm('¿Estás seguro de que quieres eliminar este registro?');">Eliminar</a>
                    {% endif %}
                </li>
                {% endfor %}
            </ul>
        </div>

        <h3>Opciones de Comparación</h3>
        <a href="{% url 'comparison_options' %}" class="comparison-link">Ir a la Comparación</a>

        <!-- Formulario para cerrar sesión -->
        <form method="POST" action="{% url 'logout' %}">
            {% csrf_token %}
            <button type="submit" class="button logout-btn">Cerrar sesión</button>
        </form>

        <!-- Formulario de cambio de contraseña, solo si el usuario es el dueño del perfil -->
        {% if form %}
        <br><br>
        <a href="{% url 'password_change' %}" class="button">Cambiar Contraseña</a>
        {% endif %}
        
        <br><br>
        <button class="button" onclick="window.history.back();">Regresar</button>
    </div>
</body>
</html>